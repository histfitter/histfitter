stages:
  - docker
  - test

build_latest_image:
  stage: docker
  except:
  - tags
  tags:
    - docker-image-build
  script:
    - ignore

build_tagged_image:
  stage: docker
  variables:
    TO: $CI_REGISTRY_IMAGE:$CI_COMMIT_TAG
  only:
  - tags
  tags:
    - docker-image-build
  script:
    - ignore

test:
  stage: test
  image: $CI_REGISTRY_IMAGE:latest
  before_script:
    - cd /HistFitter
    - ls -lrt 
    - source setup.sh
    - curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
    #- python get-pip.py # to be put back with  python3
    #- pip install pytest #to be put back with python2
  script:
    - echo "This job tests something"
    #- pytest # to be put back with python2
    - HistFitter.py -w -f analysis/tutorial/MyUserAnalysis.py
